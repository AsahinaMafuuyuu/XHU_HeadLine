

---
## 统一约定

- 基本 API 前缀（约定）
    - 开发 / 本地：`/api`（前端可通过 Vite 代理将 /api 转发到后端 baseUrl）
    - 后端实际前缀：`http://localhost:7111`
- 返回格式（统一）：
```json
{
  "code": 1,       // 1: 成功，0: 失败 / 错误
  "message": "ok",
  "data": { ... }  // 或数组 / null
}

```
- 鉴权
    
    - 登录成功后后端返回 token（JWT）
    - 前端每次受保护接口在 header 中带上：
        - Authorization: Bearer `<token>`
-  时间格式：`YYYY-MM-DD HH:mm:ss`
    
- 分页约定：请求带 `page`, `size`（page 从 1 开始）；返回 data 包含 `{ rows: [...], total: number, page: number, size: number }`
    

---

## 页面与 UI 元素映射

- 顶部：`.header`（title、返回按钮、搜索框）
    - 搜索输入：`.search-input` -> 触发 `GET /api/news?keyword=...`
- 主容器：`.content-container` -> 多个 `.page` 节点（homePage、publishPage、settingPage、myPage...）
- 首页列表：`.news-list`，每项 `.news-item`，需在 DOM 上放 `data-id`、点赞/收藏/评论按钮
- 底部导航：`.bottom-nav` -> 切换页（home/publish/setting/my）
- 提示：`#toast` -> 显示操作结果

---

## 接口列表（用户端）

### 1. 登录 (获取 token)

- 方法：POST
- 路径：/api/auth/login
- Auth：无
- Body (JSON)
```JSON
{
  "userName": "zhangsan",
  "password": "123456"
}
```
- 成功响应
```JSON
{
  "code": 1,
  "message": "登录成功",
  "data": {
    "token": "eyJ...",
    "user": {
      "id": 1001,
      "userName": "zhangsan",
      "nickName": "张三",
      "avatarUrl": "https://....png",
      "role": 2
    }
  }
}
```
- 错误示例
```JSON
{
  "code": 0,
  "message": "用户名或密码错误",
  "data": null
}
```
---

### 2. 获取当前用户信息（我的资料）

- 方法：GET
- 路径：/api/user/profile
- Auth：需要
- 返回 data: user 对象（id, userName, nickName, avatarUrl, phone, role, createTime）

---

### 3. 资讯列表（首页）

- 方法：GET
    
- 路径：/api/news
    
- Auth：可选（未登录也可查看）
    
- Query 参数：
    
    - page (int, default 1)
    - size (int, default 10)
    - keyword (string, 可选)
    - categoryId (int, 可选)
    - sort (string, one of "time","like","view", default "time")
- 成功响应 data:
```JSON
{
  "rows": [
    {
      "id": 10001,
      "title": "标题",
      "summary": "摘要...",
      "authorName": "张三",
      "coverImages": ["https://oss.../cover.jpg", "https://oss.../img1.jpg"], 
      //列表页仅取 coverImages[0] 作为封面展示
      "viewCount": 123,
      "likeCount": 45,
      "createdAt": "2025-11-28 10:00:00"
    }
  ],
  "total": 234
}
```

- 前端：加载后渲染 `.news-list`，每条 `.news-item` 需包含 `data-id` 与按钮状态（liked/favorited）

---

### 4. 资讯详情

- 方法：GET
- 路径：/api/news/{id}
- Auth：可选
- 返回 data:
```JSON
{
  "id": 10001,
  "title": "标题",
  "authorName": "张三",
  "createTime": "2025-11-28 10:00:00",
  
  // 1. 纯文本内容，无 HTML 标签，段落以 \n 分隔
  "content": "这是第一段文字。\n\n这是第二段文字，描述了运动会的场景。\n\n这是第三段总结。",
  
  // 2. 图片数组
  // Index 0: 详情页顶部 Banner 大图
  // Index 1+: 正文配图 (需前端逻辑插入到 content 段落间)
  "coverImages": [
      "https://oss.../banner.jpg", 
      "https://oss.../body_img1.jpg",
      "https://oss.../body_img2.jpg"
  ],
  
  "viewCount": 123,
  "likeCount": 45,
  "liked": true,      // 当前用户是否点赞
}
```

- 注意：进入详情时应调用「增加浏览数」接口

---

### 5. 增加浏览数

- 方法：POST
- 路径：/api/news/{id}/view
- Auth：可选
- Body：无
- 返回 data: { viewCount: number }

调用场景：详情页加载或列表曝光时（按策略采样，避免频繁触发）

---

### 6. 点赞 / 取消点赞

- 点赞：
    - 方法：POST
    - 路径：/api/news/{id}/like
    - Auth：需要
    - Body：无
    - 返回 data: { likeCount: number, liked: true }
- 取消点赞：
    - 方法：DELETE
    - 路径：/api/news/{id}/like
    - Auth：需要
    - 返回 data: { likeCount: number, liked: false }

后端约定：唯一索引 (user_id, target_id, target_type) 防止重复点赞

---


### 7. 评论列表（帖子的评论）

- 方法：GET
- 路径：/api/news/{id}/comments
- Query: page, size
- 返回 data:
```JSON
{
  "rows": [
    {
      "id": 20001,
      "postId": 10001,
      "userId": 1002,
      "nickName": "李四",
      "avatarUrl": "...",
      "content": "评论内容",
      "parentId": 0,
      "likeCount": 3,
      "createTime": "2025-11-28 12:00:00",
      "replies": [ /* optional nested replies */ ]
    }
  ],
  "total": 12,
  "page": 1,
  "size": 10
}
```
---

### 8. 发表评论 / 回复

- 方法：POST
- 路径：/api/news/{id}/comments
- Auth：需要
- Body:
```JSON
{
  "content": "评论文字",
  "parentId": 0  // 0 表示直接评论帖子；>0 表示回复某条评论
}
```
- 返回 data: 新创建的 comment 对象（含 id / createTime）

---

### 9. 发布帖子（用户端发布）

- 方法：POST
- 路径：/api/news
- Auth：需要
- Content-Type：application/json 或 multipart/form-data（含附件时）
- Body (JSON):
```JSON
{
  "title": "标题",
  "content": "<p>正文HTML</p>",
  "categoryId": 101,
  "coverImages": ["https://.../1.png"],
  "status": 1  // 1=待审核（或按后端定）
}
```

- 返回 data: { id: newId }

前端注意：若后端期望 images 字段为 JSON 字符串（如 news_post.cover_images 存储为字符串）则在提交前 JSON.stringify(images)

---

### 10. 文件/图片上传（返回 URL）

- 方法：POST
- 路径：/api/upload
- Auth：需要
- Content-Type：multipart/form-data
- Form field: `file` 或 `files[]`
- 返回 data:
```JSON
{
  "url": "https://oss.xxx.com/path/to/file.png",
  "name": "file.png",
  "size": 12345
}
```

前端：将返回的 url 填入 coverImages 或 content 的 img 标签

---

### 11. 我的发布（用户个人发布列表）

- 方法：GET
- 路径：/api/user/news
- Auth：需要
- Query: page, size
- 返回 data: 分页的 news rows

---

### 12. 分类列表（频道）

- 方法：GET
- 路径：/api/category/list
- Auth：可选
- 返回 data: [{ id, name, sortOrder }]

---

### 13. 敏感词检查

- 方法：POST
- 路径：/api/sensitive/check
- Auth：可选（提交内容检查）
- Body: { content: "待检查文本" }
- 返回 data: { matched: true/false, words: ["词1","词2"] }

---

## 错误码与常见错误处理

- code = 1 : 成功
- code = 0 : 业务失败（message 提示）
- HTTP 401 : token 失效或未登录 -> 前端应跳转登录页
- HTTP 403 : 无权限（例如普通用户调用管理员接口）
- HTTP 400 : 参数错误（message 中包含字段提示）
- HTTP 5xx : 后端异常，前端显示通用错误提示并上报

前端策略：

- 对 401 做统一拦截（清除 token，跳转登录）
- 对网络错误做重试（指数退避，最多 2 次）
- 大请求（上传/下载）显示进度条
